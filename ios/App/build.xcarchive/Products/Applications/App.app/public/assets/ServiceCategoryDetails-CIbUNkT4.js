import{p as j,f as E,e as L,aC as z,aR as Z,u as J,aY as X,b2 as Y,r as S,c as Q,aE as ee,aG as i,aH as l,aS as te,aN as $,aT as se,aI as e,aJ as g,aK as M,aL as A,aW as oe,aM as N,aX as ae,o as ie}from"./index-BYuuB5GE.js";import{u as le}from"./serviceCategoriesStore-BY_eSJkP.js";class re{constructor(){}generateTimeSlots(m=9,v=17,a=30){const d=[],n=m*60,r=v*60;for(let y=n;y<r;y+=a){const k=Math.floor(y/60),p=y%60,b=`${k.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`;d.push({time:b,displayTime:b,isReserved:!1})}return d}async getAvailableTimeSlots(m,v,a,d){return j.timeOperation("getAvailableTimeSlots",async()=>{try{console.log("🚀 Getting available time slots:",{projectId:m,serviceId:v,categoryId:a,date:d});const n=await this.getCategoryDetails(m,a);let r;if(n&&n.timeSlotInterval){const h=new Date(d).toLocaleDateString("en-US",{weekday:"long"}).toLowerCase(),f=n.availability?.[h];if(f&&f.available){const w=parseInt(f.startTime.split(":")[0]),T=parseInt(f.endTime.split(":")[0]),C=n.timeSlotInterval||30;r=this.generateTimeSlots(w,T,C)}else return console.log("🚀 ServiceTimeSlotService: Day not available for service"),[]}else r=this.generateTimeSlots();const y=`projects/${m}/serviceBookings`,k={filters:[{field:"serviceId",operator:"==",value:v},{field:"selectedDate",operator:"==",value:d},{field:"status",operator:"in",value:["open","processing"]}],timeoutMs:6e3},p=await E.getDocs(y,k),b=[];p.docs&&p.docs.length>0&&p.docs.forEach(c=>{const h=c.data();h.selectedTime&&b.push(h.selectedTime)});const u=r.map(c=>({...c,isReserved:b.includes(c.time)}));return console.log("🚀 ServiceTimeSlotService: Generated",u.length,"time slots"),u}catch(n){return console.error("❌ Error getting available time slots:",n),L.handleFirestoreError(n,"getAvailableTimeSlots"),[]}})}async getCategoryDetails(m,v){return j.timeOperation("getCategoryDetails",async()=>{try{console.log("🚀 Getting category details:",{projectId:m,categoryId:v});const a=`projects/${m}/serviceCategories/${v}`,d=await E.getDoc(a);return d.exists?(console.log("🚀 ServiceTimeSlotService: Retrieved category details"),d.data()):(console.log("🚀 ServiceTimeSlotService: Category not found"),null)}catch(a){return console.error("❌ Error getting category details:",a),L.handleFirestoreError(a,"getCategoryDetails"),null}})}async checkSlotAvailability(m,v,a,d){return j.timeOperation("checkSlotAvailability",async()=>{try{console.log("🚀 Checking slot availability:",{projectId:m,serviceId:v,date:a,time:d});const n=`projects/${m}/serviceBookings`,r={filters:[{field:"serviceId",operator:"==",value:v},{field:"selectedDate",operator:"==",value:a},{field:"selectedTime",operator:"==",value:d},{field:"status",operator:"in",value:["open","processing"]}],timeoutMs:6e3},y=await E.getDocs(n,r),k=!y.docs||y.docs.length===0;return console.log("🚀 ServiceTimeSlotService: Slot availability:",k?"available":"booked"),k}catch(n){return console.error("❌ Error checking slot availability:",n),L.handleFirestoreError(n,"checkSlotAvailability"),!1}})}}const ne=new re,ce={class:"service-category-details"},de={key:0,class:"loading-container"},ve={key:1,class:"error-container"},ue={key:2,class:"services-list"},ge={class:"section-title"},me=["onClick"],ye={class:"service-info"},he={class:"service-name"},Se={class:"service-description"},ke={class:"service-price"},pe={key:3,class:"no-services"},be={class:"dialog-content"},fe={class:"service-info"},we={class:"service-name"},_e={class:"service-description"},Ce={class:"service-price"},Te={class:"availability-section"},De={class:"calendar-grid"},Be=["onClick"],Pe={class:"day-name"},je={class:"day-date"},Ee={key:0,class:"day-time"},Le={key:1,class:"day-status"},$e={key:0,class:"time-slots-section"},Me={key:0,class:"loading-time-slots"},Ae={key:1,class:"time-slots-grid"},Oe=["onClick"],Re={class:"time-slot-time"},Ne={key:0,class:"time-slot-status"},Ie={key:2,class:"no-time-slots"},Ue={class:"booking-actions"},xe=["disabled"],Fe=Object.assign({name:"ServiceCategoryDetails"},{__name:"ServiceCategoryDetails",setup(I){const m=Z(),v=le(),a=J(),d=X(),n=Y(),r=S(null),y=S([]),k=S(!1),p=S(null),b=S(!1),u=S(null),c=S(null),h=S(null),f=S([]),w=S([]),T=S(!1),C=Q(()=>m.params.id);ee(async()=>{await U(),await O()});const U=async()=>{a.selectedProject?.id&&(await v.fetchCategories(a.selectedProject.id),r.value=v.getCategories.find(s=>s.id===C.value))},O=async()=>{if(!(!a.selectedProject?.id||!C.value))try{k.value=!0,p.value=null;const s=await v.getServicesByCategory(a.selectedProject.id,C.value);y.value=s}catch(s){console.error("Error loading services:",s),p.value=s.message||"Failed to load services"}finally{k.value=!1}},x=s=>{u.value=s,c.value=null,h.value=null,w.value=[],F(),b.value=!0},B=()=>{b.value=!1,u.value=null,c.value=null,h.value=null,f.value=[],w.value=[]},F=()=>{if(!r.value?.availability)return;const s=[],t=new Date;for(let o=0;o<14;o++){const _=new Date(t);_.setDate(t.getDate()+o);const P=_.toLocaleDateString("en-US",{weekday:"long"}),q=P.toLowerCase(),D=r.value.availability[q],K={name:P,date:_.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),fullDate:_.toISOString().split("T")[0],available:D?.available||!1,timeRange:D?.available?`${D.startTime} - ${D.endTime}`:null};s.push(K)}f.value=s},G=async s=>{c.value=s,h.value=null,await H(s)},W=s=>{h.value=s},R=s=>new Date(s).toLocaleDateString("en-US",{weekday:"long"}).toLowerCase(),H=async s=>{if(!(!u.value||!a.selectedProject?.id||!r.value?.id))try{T.value=!0;const t=await ne.getAvailableTimeSlots(a.selectedProject.id,u.value.id,r.value.id,s);w.value=t}catch(t){console.error("Error loading time slots:",t),w.value=[]}finally{T.value=!1}},V=async()=>{if(!(!c.value||!h.value||!u.value||!a.selectedProject?.id))try{const s={serviceId:u.value.id,categoryId:C.value,serviceName:u.value.englishTitle,categoryName:r.value?.englishTitle||"Service Category",servicePrice:u.value.price,selectedDate:c.value,selectedTime:h.value,notes:"",categoryTimeSlotInterval:r.value?.timeSlotInterval||30,categoryStartTime:r.value?.availability?.[R(c.value)]?.startTime||"09:00",categoryEndTime:r.value?.availability?.[R(c.value)]?.endTime||"17:00"};await n.createBooking(a.selectedProject.id,s),d.showSuccess("Service booked successfully!"),await new Promise(o=>setTimeout(o,500));const t=await ie.getCurrentUser();t&&await n.fetchUserBookings(a.selectedProject.id,t.uid),B(),console.log("Service booking created:",s)}catch(s){console.error("Error creating service booking:",s),d.showError("Failed to book service. Please try again.")}};return(s,t)=>(l(),i("div",ce,[te(se,{title:r.value?.englishTitle||s.$t("loadingLabel")},null,8,["title"]),k.value?(l(),i("div",de,[t[1]||(t[1]=e("div",{class:"loading-spinner"},null,-1)),e("p",null,g(s.$t("loadingServices")),1)])):p.value?(l(),i("div",ve,[e("p",null,g(p.value),1),e("button",{onClick:O,class:"retry-btn"},g(s.$t("retry")),1)])):y.value.length>0?(l(),i("div",ue,[e("h3",ge,g(s.$t("availableServices")),1),(l(!0),i(M,null,A(y.value,o=>(l(),i("div",{key:o.id,class:"service-item",onClick:_=>x(o)},[e("div",ye,[e("h4",he,g(o.englishTitle),1),e("p",Se,g(o.englishDescription),1),e("div",ke,"EGP "+g(o.price),1)]),t[2]||(t[2]=e("div",{class:"service-arrow"},[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))],8,me))),128))])):(l(),i("div",pe,[...t[3]||(t[3]=[oe('<div class="no-services-icon" data-v-d564bd50><svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d564bd50><path d="M14.7 6.3C14.7 4.4 13.3 3 11.4 3C9.5 3 8.1 4.4 8.1 6.3C8.1 8.2 9.5 9.6 11.4 9.6C13.3 9.6 14.7 8.2 14.7 6.3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d564bd50></path><path d="M20 12C20 16.4 16.4 20 12 20C7.6 20 4 16.4 4 12C4 7.6 7.6 4 12 4C16.4 4 20 7.6 20 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d564bd50></path><path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-d564bd50></path></svg></div><h3 data-v-d564bd50>No Services Available</h3><p data-v-d564bd50>There are no services available in this category yet.</p>',3)])])),b.value?(l(),i("div",{key:4,class:"booking-dialog-overlay",onClick:B},[e("div",{class:"booking-dialog",onClick:t[0]||(t[0]=ae(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[t[5]||(t[5]=e("h3",{class:"dialog-title"},"Book Service",-1)),e("button",{onClick:B,class:"close-btn"},[...t[4]||(t[4]=[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),e("div",be,[e("div",fe,[e("h4",we,g(u.value?.englishTitle),1),e("p",_e,g(u.value?.englishDescription),1),e("div",Ce,"EGP "+g(u.value?.price),1)]),e("div",Te,[t[6]||(t[6]=e("h4",{class:"section-title"},"Select Available Date",-1)),e("div",De,[(l(!0),i(M,null,A(f.value,(o,_)=>(l(),i("div",{key:_,class:N(["day-option",{selected:c.value===o.fullDate,unavailable:!o.available}]),onClick:P=>o.available&&G(o.fullDate)},[e("div",Pe,g(o.name),1),e("div",je,g(o.date),1),o.available?(l(),i("div",Ee,g(o.timeRange),1)):(l(),i("div",Le,"Unavailable"))],10,Be))),128))])]),c.value?(l(),i("div",$e,[t[9]||(t[9]=e("h4",{class:"section-title"},"Select Time Slot",-1)),T.value?(l(),i("div",Me,[...t[7]||(t[7]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading available time slots...",-1)])])):w.value.length>0?(l(),i("div",Ae,[(l(!0),i(M,null,A(w.value,o=>(l(),i("div",{key:o.time,class:N(["time-slot",{selected:h.value===o.time,unavailable:o.isReserved}]),onClick:_=>!o.isReserved&&W(o.time)},[e("div",Re,g(o.time),1),o.isReserved?(l(),i("div",Ne,"Booked")):$("",!0)],10,Oe))),128))])):(l(),i("div",Ie,[...t[8]||(t[8]=[e("p",null,"No time slots available for this date.",-1)])]))])):$("",!0),e("div",Ue,[e("button",{onClick:V,disabled:!c.value||!h.value,class:"book-btn"}," Book Service ",8,xe)])])])])):$("",!0)]))}}),He=z(Fe,[["__scopeId","data-v-d564bd50"]]);export{He as default};
