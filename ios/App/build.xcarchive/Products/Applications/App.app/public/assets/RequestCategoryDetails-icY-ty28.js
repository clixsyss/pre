const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BYuuB5GE.js","assets/index-BWVvr855.css"])))=>i.map(i=>d[i]);
import{aC as Y,aR as K,aD as J,u as Q,r as c,c as X,aE as ee,aG as i,aH as a,aS as oe,aN as h,aT as te,aI as t,aJ as g,aK as U,aL as I,aU as y,aQ as _,aV as v,aW as re,aX as se,o as le,_ as ie}from"./index-BYuuB5GE.js";import{u as ae,r as ne}from"./requestSubmissionService-CmTvgOhS.js";const ue={class:"request-category-details"},de={key:0,class:"loading-container"},ce={key:1,class:"error-container"},pe={key:2,class:"request-form-container"},ge={class:"form-fields"},me=["for"],he={key:0,class:"required"},fe=["id","onUpdate:modelValue","placeholder","required"],ye=["id","onUpdate:modelValue","placeholder","required"],ve={key:2,class:"currency-input"},ke=["id","onUpdate:modelValue","placeholder","required"],we=["id","onUpdate:modelValue","placeholder","required"],Ce=["id","onUpdate:modelValue","placeholder","required"],be=["id","onUpdate:modelValue","placeholder","required"],qe={key:0,class:"media-upload-section"},_e={class:"upload-section"},xe={key:0,class:"upload-options"},Fe={key:0,class:"selected-files"},Ne={class:"file-list"},je={class:"file-info"},$e={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ve={key:1,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Pe={class:"file-name"},Se={class:"file-size"},Ee=["onClick"],Ue={class:"form-actions"},Ie=["disabled"],Me={key:0,class:"upload-progress"},Te=Object.assign({name:"RequestCategoryDetails"},{__name:"RequestCategoryDetails",setup(De){const M=K(),T=J(),P=ae(),k=Q(),u=c(null),x=c(!1),w=c(null),C=c(!1),d=c({}),p=c([]),f=c(!1),S=X(()=>M.params.id);ee(async()=>{await E()});const E=async()=>{if(!(!k.selectedProject?.id||!S.value))try{if(x.value=!0,w.value=null,await P.fetchCategories(k.selectedProject.id),u.value=P.getCategories.find(r=>r.id===S.value),!u.value){w.value="Request category not found";return}D()}catch(r){console.error("Error loading category:",r),w.value=r.message||"Failed to load request category"}finally{x.value=!1}},D=()=>{if(!u.value?.fields){console.warn("No fields found in category");return}console.log("🔧 Initializing form data for fields:",u.value.fields.map(o=>o.id));const r={};u.value.fields.forEach(o=>{r[o.id]=""}),d.value=r,console.log("✅ Form data initialized:",d.value)},F=c(null),N=c(null),j=c(null),B=()=>{try{console.log("📁 Triggering file picker"),f.value=!1,F.value?F.value.click():console.error("File input not found")}catch(r){console.error("Error triggering file upload:",r)}},L=()=>{try{console.log("🖼️ Triggering image library"),f.value=!1,N.value?N.value.click():console.error("Image input not found")}catch(r){console.error("Error triggering image library:",r)}},R=()=>{try{console.log("📷 Triggering camera"),f.value=!1,j.value?j.value.click():console.error("Camera input not found")}catch(r){console.error("Error triggering camera:",r)}},$=r=>{try{if(console.log("📁 File selection event triggered"),!r.target||!r.target.files){console.warn("No files in event target");return}const o=Array.from(r.target.files);if(console.log("📁 Files selected:",o.length,o.map(e=>e.name)),o.length===0){console.log("No files selected");return}z(o),r.target&&(r.target.value="")}catch(o){console.error("❌ Error handling file selection:",o),alert("Error selecting files. Please try again.")}},z=async r=>{try{if(console.log("📁 Processing files:",r.length),!r||!Array.isArray(r)||r.length===0){console.warn("No files to process");return}const{Capacitor:o}=await ie(async()=>{const{Capacitor:s}=await import("./index-BYuuB5GE.js").then(n=>n.ct);return{Capacitor:s}},__vite__mapDeps([0,1])),e=o.isNativePlatform(),l=e?50*1024*1024:10*1024*1024,b=o.getPlatform(),m=[];for(const s of r)try{if(!s||!s.name){console.warn("Invalid file object");continue}const n=["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/heic","image/heif","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(s.size>l){console.warn(`File ${s.name} is too large: ${s.size} bytes`);const W=Math.round(l/1024/1024);alert(`File ${s.name} is too large. Maximum size is ${W}MB.`);continue}const q=s.type||"",V=s.name.toLowerCase(),G=q.startsWith("image/")||/\.(jpg|jpeg|png|gif|webp|heic|heif)$/i.test(V),Z=n.includes(q)||/\.(pdf|doc|docx|txt)$/i.test(V);if(e&&!q&&V&&console.log(`📱 ${b}: File type not detected for ${s.name}, using filename extension`),!G&&!Z){console.warn(`File type not supported: ${q} for file ${s.name}`),alert(`File type not supported for ${s.name}. Please use images, PDF, or document files.`);continue}console.log(`✅ File ${s.name} is valid`),m.push(s)}catch(n){console.error(`Error validating file ${s.name}:`,n)}m.length>0&&(p.value=[...p.value,...m],console.log(`✅ Added ${m.length} valid files`)),m.length!==r.length&&console.warn(`⚠️ ${r.length-m.length} files were rejected`)}catch(o){console.error("❌ Error processing files:",o),alert("Error processing files. Please try again.")}},H=r=>{p.value.splice(r,1)},A=r=>{if(r===0)return"0 Bytes";const o=1024,e=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(r)/Math.log(o));return parseFloat((r/Math.pow(o,l)).toFixed(2))+" "+e[l]},O=async()=>{if(!u.value){console.error("No category found");return}try{C.value=!0,console.log("🚀 Starting request submission..."),console.log("📋 Current form data:",d.value),console.log("📋 Category fields:",u.value.fields);const r=[];if(u.value.fields.forEach(s=>{const n=d.value[s.id];console.log(`🔍 Checking field ${s.id} (${s.fieldName}):`,n,"Type:",typeof n,"Required:",s.required),s.required&&(!n||typeof n=="string"&&n.trim()===""||n===null||n===void 0)&&r.push(s.fieldName)}),r.length>0){console.warn("Missing required fields:",r),alert(`Please fill in the following required fields: ${r.join(", ")}`);return}console.log("🔐 Getting current user...");const o=await le.getCurrentUser();if(!o){console.error("No user found"),alert("You must be logged in to submit a request");return}if(console.log("✅ User found:",o.uid),!k.selectedProject?.id){console.error("No project selected"),alert("No project selected. Please try again.");return}console.log("✅ Project found:",k.selectedProject.id);const e={};u.value.fields.forEach(s=>{const n=d.value[s.id];n==null?e[s.id]="":typeof n=="string"?e[s.id]=n.trim():e[s.id]=String(n)}),console.log("🧹 Cleaned form data:",e);const l={categoryId:u.value.id,categoryName:u.value.englishTitle,userId:o.uid,userName:o.displayName||"Unknown User",userEmail:o.email,userPhone:o.phoneNumber||"",formData:e,fieldMetadata:u.value.fields.map(s=>({id:s.id,fieldName:s.fieldName,fieldType:s.fieldType,required:s.required,placeholder:s.placeholder})),mediaFiles:p.value.map(s=>({name:s.name,type:s.type,size:s.size})),status:"pending",createdAt:new Date,projectId:k.selectedProject.id};console.log("📝 Submission data prepared:",l),console.log("📝 Field metadata:",l.fieldMetadata),console.log("📝 Category fields:",u.value.fields),console.log("📁 Files to upload:",p.value.length);const b=await ne.submitRequest(l,p.value);console.log("✅ Request submitted successfully with ID:",b),/iPad|iPhone|iPod/.test(navigator.userAgent)&&(console.log("📱 iOS: Request submission completed successfully"),console.log("📱 iOS: Submission ID:",b),console.log("📱 iOS: Category:",l.categoryName),console.log("📱 iOS: User:",l.userName)),alert("Your request has been submitted successfully!"),T.push("/facilities")}catch(r){console.error("❌ Error submitting request:",r),console.error("Error details:",{message:r.message,code:r.code,stack:r.stack}),alert(`Failed to submit request: ${r.message||"Please try again."}`)}finally{C.value=!1}};return(r,o)=>(a(),i("div",ue,[oe(te,{title:u.value?.englishTitle||r.$t("requestCategory"),subtitle:u.value?.description||r.$t("submitYourRequest")},null,8,["title","subtitle"]),x.value?(a(),i("div",de,[o[1]||(o[1]=t("div",{class:"loading-spinner"},null,-1)),t("p",null,g(r.$t("loadingRequestForm")),1)])):w.value?(a(),i("div",ce,[t("p",null,g(w.value),1),t("button",{onClick:E,class:"retry-btn"},g(r.$t("retry")),1)])):u.value?(a(),i("div",pe,[t("form",{onSubmit:se(O,["prevent"]),class:"request-form"},[t("div",ge,[t("h3",null,g(r.$t("requestDetails")),1),(a(!0),i(U,null,I(u.value.fields,e=>(a(),i("div",{key:e.id,class:"field-group"},[t("label",{for:e.id,class:"field-label"},[_(g(e.fieldName)+" ",1),e.required?(a(),i("span",he,"*")):h("",!0)],8,me),e.fieldType==="text"?y((a(),i("input",{key:0,id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,type:"text",placeholder:e.placeholder||`Enter ${e.fieldName.toLowerCase()}`,required:e.required,class:"field-input"},null,8,fe)),[[v,d.value[e.id]]]):e.fieldType==="number"?y((a(),i("input",{key:1,id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,type:"number",placeholder:e.placeholder||`Enter ${e.fieldName.toLowerCase()}`,required:e.required,class:"field-input"},null,8,ye)),[[v,d.value[e.id]]]):e.fieldType==="currency"?(a(),i("div",ve,[o[2]||(o[2]=t("span",{class:"currency-symbol"},"EGP",-1)),y(t("input",{id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,type:"number",step:"0.01",placeholder:e.placeholder||"0.00",required:e.required,class:"field-input currency-field"},null,8,ke),[[v,d.value[e.id]]])])):e.fieldType==="phone"?y((a(),i("input",{key:3,id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,type:"tel",placeholder:e.placeholder||`Enter ${e.fieldName.toLowerCase()}`,required:e.required,class:"field-input"},null,8,we)),[[v,d.value[e.id]]]):e.fieldType==="email"?y((a(),i("input",{key:4,id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,type:"email",placeholder:e.placeholder||`Enter ${e.fieldName.toLowerCase()}`,required:e.required,class:"field-input"},null,8,Ce)),[[v,d.value[e.id]]]):e.fieldType==="description"?y((a(),i("textarea",{key:5,id:e.id,"onUpdate:modelValue":l=>d.value[e.id]=l,placeholder:e.placeholder||`Enter ${e.fieldName.toLowerCase()}`,required:e.required,rows:"4",class:"field-textarea"},null,8,be)),[[v,d.value[e.id]]]):h("",!0)]))),128))]),u.value.allowMediaUpload?(a(),i("div",qe,[o[10]||(o[10]=t("h3",null,"Attachments",-1)),o[11]||(o[11]=t("p",{class:"media-description"},"Upload files or images to support your request",-1)),t("div",_e,[t("button",{type:"button",onClick:o[0]||(o[0]=e=>f.value=!f.value),class:"upload-button"},[...o[3]||(o[3]=[re('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-18ccf71b><path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-18ccf71b></path><polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-18ccf71b></polyline><path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-18ccf71b></path><path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-18ccf71b></path><polyline points="10,9 9,9 8,9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-18ccf71b></polyline></svg> Add Files ',2)])]),f.value?(a(),i("div",xe,[t("button",{type:"button",onClick:L,class:"upload-option"},[...o[4]||(o[4]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2"}),t("circle",{cx:"8.5",cy:"8.5",r:"1.5",stroke:"currentColor","stroke-width":"2"}),t("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor","stroke-width":"2"})],-1),_(" Choose from Library ",-1)])]),t("button",{type:"button",onClick:B,class:"upload-option"},[...o[5]||(o[5]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("polyline",{points:"14,2 14,8 20,8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),_(" Choose Files ",-1)])]),t("button",{type:"button",onClick:R,class:"upload-option"},[...o[6]||(o[6]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M23 19C23 19.5304 22.7893 20.0391 22.4142 20.4142C22.0391 20.7893 21.5304 21 21 21H3C2.46957 21 1.96086 20.7893 1.58579 20.4142C1.21071 20.0391 1 19.5304 1 19V8C1 7.46957 1.21071 6.96086 1.58579 6.58579C1.96086 6.21071 2.46957 6 3 6H7L9 4H15L17 6H21C21.5304 6 22.0391 6.21071 22.4142 6.58579C22.7893 6.96086 23 7.46957 23 8V19Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor","stroke-width":"2"})],-1),_(" Take Photo ",-1)])])])):h("",!0),t("input",{ref_key:"fileInput",ref:F,type:"file",multiple:"",accept:"image/*,application/pdf,.doc,.docx,.txt,.heic,.heif",onChange:$,class:"file-input",style:{display:"none"}},null,544),t("input",{ref_key:"imageInput",ref:N,type:"file",multiple:"",accept:"image/*",onChange:$,class:"file-input",style:{display:"none"}},null,544),t("input",{ref_key:"cameraInput",ref:j,type:"file",accept:"image/*",capture:"environment",onChange:$,class:"file-input",style:{display:"none"}},null,544)]),p.value.length>0?(a(),i("div",Fe,[t("h4",null,"Selected Files ("+g(p.value.length)+")",1),t("div",Ne,[(a(!0),i(U,null,I(p.value,(e,l)=>(a(),i("div",{key:l,class:"file-item"},[t("div",je,[e.type.startsWith("image/")?(a(),i("svg",$e,[...o[7]||(o[7]=[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2"},null,-1),t("circle",{cx:"8.5",cy:"8.5",r:"1.5",stroke:"currentColor","stroke-width":"2"},null,-1),t("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor","stroke-width":"2"},null,-1)])])):(a(),i("svg",Ve,[...o[8]||(o[8]=[t("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("polyline",{points:"14,2 14,8 20,8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),t("span",Pe,g(e.name),1),t("span",Se,"("+g(A(e.size))+")",1)]),t("button",{onClick:b=>H(l),type:"button",class:"remove-file-btn"},[...o[9]||(o[9]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Ee)]))),128))])])):h("",!0)])):h("",!0),t("div",Ue,[t("button",{type:"submit",disabled:C.value,class:"submit-btn"},[t("span",null,g(C.value?"Uploading files...":"Submit Request"),1)],8,Ie),C.value?(a(),i("div",Me,[...o[12]||(o[12]=[t("p",null,"Please wait while we process and upload your files...",-1),t("div",{class:"progress-bar"},[t("div",{class:"progress-fill"})],-1),t("p",{class:"upload-note"},"Large images are automatically compressed for faster upload",-1)])])):h("",!0)])],32)])):h("",!0)]))}}),Re=Y(Te,[["__scopeId","data-v-18ccf71b"]]);export{Re as default};
