import{aC as T,aD as z,u as R,r as c,c as G,aF as j,aE as H,b4 as O,aG as n,aH as l,aS as W,ba as J,aN as _,aT as K,aI as t,aJ as a,aK as M,aL as L,aM as S,aQ as y,aW as Q,bb as Y,o as Z,bc as q}from"./index-BYuuB5GE.js";const X={class:"violations-page"},ee={key:0,class:"loading-container"},te={key:1,class:"page-content"},se={class:"summary-section"},oe={class:"summary-card"},ae={class:"summary-stats"},le={class:"stat-item"},ne={class:"stat-number"},ie={class:"stat-label"},re={class:"stat-item"},de={class:"stat-number"},ce={class:"stat-label"},ue={class:"stat-item"},ve={class:"stat-number"},ge={class:"stat-label"},he={class:"stat-item"},pe={class:"stat-number"},_e={class:"stat-label"},me={class:"violations-section"},ke={class:"section-header"},ye={class:"filter-tabs"},we=["onClick"],Pe={key:0,class:"count-badge"},Ve={key:0,class:"empty-state"},Ce={key:0},be={key:1},fe={key:1,class:"violations-list"},je=["onClick"],Me={class:"violation-header"},Le={class:"violation-status"},Se={width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},De={key:0,d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},xe={key:1,d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ie={key:2,d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},$e={key:3,d:"M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ee={class:"violation-amount"},Fe={class:"violation-date"},Ue={class:"violation-content"},Be={class:"violation-reason"},Ne={key:0,class:"violation-description"},Ae={class:"violation-dates"},Te={class:"occurrence-date"},ze={key:0,class:"unread-badge"},Re=Object.assign({name:"ViolationsPage"},{__name:"ViolationsPage",setup(Ge){const D=z(),r=R(),m=c(!1),g=c([]),d=c({total:0,issued:0,paid:0,disputed:0,cancelled:0}),u=c("all"),h=c(!1),k=c(null),i=c(null),x=async()=>{const e=await Z.getCurrentUser();i.value=e?.uid},I=[{value:"all",label:"All"},{value:"issued",label:"Issued"},{value:"paid",label:"Paid"},{value:"disputed",label:"Disputed"},{value:"cancelled",label:"Cancelled"}],w=G(()=>u.value==="all"?g.value:g.value.filter(e=>e.status===u.value)),v=async()=>{if(console.log("ViolationsPage: loadViolations called"),console.log("ViolationsPage: Project:",r.selectedProject?.id),console.log("ViolationsPage: User ID:",i.value),!r.selectedProject||!i.value){console.log("ViolationsPage: Missing project or user, skipping load");return}try{m.value=!0,console.log("ViolationsPage: Loading violations from Firestore...");const e=await q(r.selectedProject.id,i.value);console.log("ViolationsPage: Loaded violations:",e.length),console.log("ViolationsPage: Violations data:",e),g.value=e;const o=e.reduce((s,p)=>(s.total++,s[p.status]=(s[p.status]||0)+1,s),{total:0,issued:0,paid:0,disputed:0,cancelled:0});d.value=o,console.log("ViolationsPage: Calculated stats:",o)}catch(e){console.error("ViolationsPage: Error loading violations:",e),console.error("ViolationsPage: Error details:",{message:e.message,stack:e.stack,projectId:r.selectedProject?.id,userId:i.value}),g.value=[],d.value={total:0,issued:0,paid:0,disputed:0,cancelled:0}}finally{m.value=!1}},$=e=>{u.value=e},P=e=>e==="all"?d.value.total:d.value[e]||0,E=e=>{k.value=e,h.value=!0},F=()=>{h.value=!1,k.value=null},U=e=>{D.push(`/violation-chat/${e.id}`)},B=e=>new Intl.NumberFormat("en-EG",{style:"currency",currency:"EGP"}).format(e),V=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",N=e=>({issued:"Issued",paid:"Paid",disputed:"Disputed",cancelled:"Cancelled"})[e]||e,A=e=>({issued:"status-issued",paid:"status-paid",disputed:"status-disputed",cancelled:"status-cancelled"})[e]||"status-issued",C=e=>!e.messages||!Array.isArray(e.messages)?0:e.messages.filter(o=>(o.sender==="admin"||o.sender==="system")&&!o.readBy?.includes(i.value)).length,b=()=>{console.log("ViolationsPage: Project store ready, loading violations..."),setTimeout(()=>{v()},500)},f=()=>{console.log("ViolationsPage: Project changed, reloading violations..."),setTimeout(()=>{v()},500)};return j(()=>r.selectedProject,(e,o)=>{e&&e.id!==o?.id&&(console.log("ViolationsPage: Project changed, reloading violations..."),setTimeout(()=>{v()},500))},{deep:!0}),j(()=>i.value,(e,o)=>{e&&e!==o&&(console.log("ViolationsPage: User changed, reloading violations..."),setTimeout(()=>{v()},500))}),H(async()=>{console.log("🚀 ViolationsPage: Component mounted, initializing..."),console.log("🚀 ViolationsPage: Current project store state:",{selectedProject:r.selectedProject,hasSelectedProject:r.hasSelectedProject}),console.log("🚀 ViolationsPage: Initializing user ID..."),await x(),console.log("🚀 ViolationsPage: User ID initialized:",i.value),console.log("🚀 ViolationsPage: Adding event listeners..."),window.addEventListener("projectStoreReady",b),window.addEventListener("projectChanged",f),r.selectedProject&&i.value?(console.log("✅ ViolationsPage: Project and user ready, loading violations..."),setTimeout(()=>{v()},500)):(console.log("⏳ ViolationsPage: Waiting for project store or user to be ready..."),console.log("⏳ ViolationsPage: Project ready:",!!r.selectedProject),console.log("⏳ ViolationsPage: User ready:",!!i.value))}),O(()=>{window.removeEventListener("projectStoreReady",b),window.removeEventListener("projectChanged",f)}),(e,o)=>(l(),n("div",X,[W(K,{title:e.$t("violationsAndFines"),subtitle:e.$t("viewManageViolations")},null,8,["title","subtitle"]),m.value?(l(),n("div",ee,[o[0]||(o[0]=t("div",{class:"loading-spinner"},null,-1)),t("p",null,a(e.$t("loadingViolations")),1)])):(l(),n("div",te,[t("div",se,[t("div",oe,[t("div",ae,[t("div",le,[t("span",ne,a(d.value.total),1),t("span",ie,a(e.$t("total")),1)]),t("div",re,[t("span",de,a(d.value.issued),1),t("span",ce,a(e.$t("issued")),1)]),t("div",ue,[t("span",ve,a(d.value.paid),1),t("span",ge,a(e.$t("paid")),1)]),t("div",he,[t("span",pe,a(d.value.disputed),1),t("span",_e,a(e.$t("disputed")),1)])])])]),t("div",me,[t("div",ke,[t("h2",null,a(e.$t("yourViolations")),1),t("div",ye,[(l(),n(M,null,L(I,s=>t("button",{key:s.value,onClick:p=>$(s.value),class:S(["filter-tab",{active:u.value===s.value}])},[y(a(s.label)+" ",1),P(s.value)>0?(l(),n("span",Pe,a(P(s.value)),1)):_("",!0)],10,we)),64))])]),w.value.length===0?(l(),n("div",Ve,[o[1]||(o[1]=t("div",{class:"empty-icon"},[t("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M20 6L9 17L4 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),o[2]||(o[2]=t("h3",null,"No Violations Found",-1)),u.value==="all"?(l(),n("p",Ce,"You have a clean record with no violations or fines.")):(l(),n("p",be,"No "+a(u.value)+" violations found.",1))])):(l(),n("div",fe,[(l(!0),n(M,null,L(w.value,s=>(l(),n("div",{key:s.id,class:"violation-card",onClick:p=>E(s)},[t("div",Me,[t("div",Le,[t("span",{class:S(["status-badge",A(s.status)])},[(l(),n("svg",Se,[s.status==="paid"?(l(),n("path",De)):s.status==="disputed"?(l(),n("path",xe)):s.status==="cancelled"?(l(),n("path",Ie)):(l(),n("path",$e))])),y(" "+a(N(s.status)),1)],2),t("div",Ee,a(B(s.amount)),1)]),t("div",Fe,a(V(s.createdAt)),1)]),t("div",Ue,[t("h4",Be,a(s.reason),1),s.description?(l(),n("p",Ne,a(s.description),1)):_("",!0),t("div",Ae,[t("span",Te,[o[3]||(o[3]=Q('<svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b3ae9401><rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" data-v-b3ae9401></rect><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" data-v-b3ae9401></line><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" data-v-b3ae9401></line><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" data-v-b3ae9401></line></svg>',1)),y(" Occurred: "+a(V(s.occurrenceDate)),1)])])]),C(s)>0?(l(),n("div",ze,a(C(s)),1)):_("",!0),o[4]||(o[4]=t("div",{class:"violation-arrow"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))],8,je))),128))]))])])),h.value?(l(),J(Y,{key:2,violation:k.value,"is-open":h.value,"user-id":i.value,onClose:F,onStartChat:U},null,8,["violation","is-open","user-id"])):_("",!0)]))}}),Oe=T(Re,[["__scopeId","data-v-b3ae9401"]]);export{Oe as default};
