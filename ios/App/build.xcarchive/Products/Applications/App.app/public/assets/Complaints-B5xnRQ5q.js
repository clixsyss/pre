import{aC as z,aD as T,aY as E,r as p,c as j,aE as W,b4 as G,aG as n,aH as i,aI as t,aN as u,aJ as a,aQ as B,aK as k,aL as g,aO as m,aM as S,aS as J,b5 as K,aX as H,aU as f,aV as N,a_ as P,aW as Q}from"./index-BYuuB5GE.js";import{u as X}from"./complaintStore-CQRCRmNB.js";import{M as Y}from"./ModalHeader-C7UKSo1F.js";const tt={class:"complaints-page"},et={class:"hero-section"},ot={class:"hero-content"},st={class:"hero-text"},nt={class:"hero-title"},it={class:"hero-subtitle"},lt={class:"quick-complaints-section"},rt={class:"section-title"},at={class:"quick-options-scroll"},dt=["onClick"],ut={class:"quick-option-icon"},ct={width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},pt={key:0,d:"M3 3H7V7H3V3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},mt={key:1,d:"M11 5L6 9H2V15H6L11 19V5Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ht={key:2,d:"M14.7 6.3A1 1 0 0 0 14 7H9.5L8.5 8L9.5 9H14A1 1 0 0 0 14.7 9.7L18.3 13.3A1 1 0 0 0 19.7 11.7L16.1 8.1L14.7 6.3Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},vt={key:3,d:"M12 22S8 18 8 13V6L12 4L16 6V13C16 18 12 22 12 22Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},kt={key:4,d:"M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},gt={key:5,d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},wt={key:6,d:"M9.09 9A3 3 0 0 1 12 6C12.5 6 13 6.5 13 7A3 3 0 0 1 9.09 9Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},Ct={key:7,d:"M12 17H12.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ft={class:"quick-option-content"},_t={class:"my-complaints-section"},yt={class:"section-header"},Mt={class:"filter-tabs"},bt=["onClick"],xt={key:0,class:"loading-state"},Lt={key:1,class:"empty-state"},Vt={key:2,class:"complaints-list"},jt=["onClick"],Bt={class:"complaint-header"},St={class:"complaint-title-section"},Ht={class:"complaint-title"},Nt={class:"complaint-category"},Pt={class:"complaint-preview"},$t={class:"complaint-footer"},Dt={class:"complaint-time"},It={class:"form-group"},Ut={class:"form-group"},At=["value"],Ft={class:"form-group"},qt=["value"],Ot={class:"form-group"},Rt={class:"form-group"},Zt={class:"file-upload-section"},zt={key:0,class:"file-preview"},Tt={class:"file-info"},Et={class:"file-icon"},Wt={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Gt={key:1,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Jt={class:"file-details"},Kt={class:"file-name"},Qt={class:"file-size"},Xt={key:0,class:"image-preview"},Yt=["src","alt"],te={class:"form-actions"},ee=["disabled"],oe=Object.assign({name:"ComplaintsPage"},{__name:"Complaints",setup(se){const M=T(),l=X(),$=E(),h=p(!1),w=p("all"),_=p(null),d=p({title:"",category:"",priority:"Medium",initialMessage:""}),c=p(null),v=p(null),y=p(null),D=[{id:"all",name:"All"},{id:"Open",name:"Open"},{id:"In Progress",name:"In Progress"},{id:"Resolved",name:"Resolved"},{id:"Closed",name:"Closed"}],b=j(()=>{let s=l.userComplaints;return w.value!=="all"&&(s=s.filter(e=>e.status===w.value)),s.sort((e,o)=>new Date(o.lastMessageAt)-new Date(e.lastMessageAt))}),x=j(()=>c.value&&c.value.type.startsWith("image/")),I=s=>{d.value.category=s.id,h.value=!0},U=s=>{M.push(`/complaints/${s.id}`)},C=()=>{h.value=!1,d.value={title:"",category:"",priority:"Medium",initialMessage:""}},A=async()=>{if(!l.loading)try{let s=null,e=null;if(c.value){const V=await l.uploadImage(c.value,"complaints");s=V.url,e=V.fileName}const o={...d.value,imageUrl:s,imageFileName:e},r=await l.createComplaint(o);console.log("✅ ComplaintsPage: Complaint created successfully:",r),console.log("✅ ComplaintsPage: Current complaints count after creation:",l.userComplaints.length),d.value={title:"",category:"",priority:"Medium",initialMessage:""},L(),C(),r&&r.id&&M.push(`/complaints/${r.id}`)}catch(s){console.error("Error creating complaint:",s)}},F=s=>!s.messages||s.messages.length===0?"No messages":s.messages[s.messages.length-1].text||"Image message",q=s=>{const e=l.complaintCategories.find(o=>o.id===s);return e?e.name:"Other"},O=s=>{if(!s)return"";const e=s.toDate?s.toDate():new Date(s),r=(new Date-e)/(1e3*60*60);return r<1?"Just now":r<24?`${Math.floor(r)}h ago`:r<168?`${Math.floor(r/24)}d ago`:e.toLocaleDateString()},R=s=>{const e=s.target.files[0];if(e){if(e.size>10*1024*1024){$.showError("File size must be less than 10MB");return}c.value=e,e.type.startsWith("image/")&&(v.value=URL.createObjectURL(e))}},L=()=>{c.value=null,v.value&&(URL.revokeObjectURL(v.value),v.value=null),y.value&&(y.value.value="")},Z=s=>{if(s===0)return"0 Bytes";const e=1024,o=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(s)/Math.log(e));return parseFloat((s/Math.pow(e,r)).toFixed(2))+" "+o[r]};return W(async()=>{try{console.log("🚀 ComplaintsPage: Component mounted, fetching complaints..."),console.log("🚀 ComplaintsPage: Current user complaints before fetch:",l.userComplaints.length),await l.fetchComplaints(),console.log("✅ ComplaintsPage: Complaints fetched, count:",l.userComplaints.length),console.log("✅ ComplaintsPage: Complaints data:",l.userComplaints),_.value=l.subscribeToComplaints()}catch(s){console.error("❌ ComplaintsPage: Error loading complaints:",s)}}),G(()=>{_.value&&_.value()}),(s,e)=>(i(),n("div",tt,[t("div",et,[t("div",ot,[t("div",st,[t("h1",nt,a(s.$t("complaintsSupport")),1),t("p",it,a(s.$t("getHelpIssues")),1),t("button",{onClick:e[0]||(e[0]=o=>h.value=!0),class:"new-complaint-btn"},[e[7]||(e[7]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 5V19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),B(" "+a(s.$t("newComplaint")),1)])])])]),t("div",lt,[t("h2",rt,a(s.$t("quickComplaints")),1),t("div",at,[(i(!0),n(k,null,g(m(l).complaintCategories,o=>(i(),n("button",{key:o.id,onClick:r=>I(o),class:"quick-option-card"},[t("div",ut,[(i(),n("svg",ct,[o.icon==="gate"?(i(),n("path",pt)):u("",!0),o.icon==="volume_off"?(i(),n("path",mt)):u("",!0),o.icon==="build"?(i(),n("path",ht)):u("",!0),o.icon==="security"?(i(),n("path",vt)):u("",!0),o.icon==="home"?(i(),n("path",kt)):u("",!0),o.icon==="receipt"?(i(),n("path",gt)):u("",!0),o.icon==="help"?(i(),n("path",wt)):u("",!0),o.icon==="help"?(i(),n("path",Ct)):u("",!0)]))]),t("div",ft,[t("h3",null,a(o.name),1),e[8]||(e[8]=t("p",null,"Report issue",-1))])],8,dt))),128))])]),t("div",_t,[e[15]||(e[15]=t("h2",{class:"section-title"},"My Complaints",-1)),t("div",yt,[t("div",Mt,[(i(),n(k,null,g(D,o=>t("button",{key:o.id,onClick:r=>w.value=o.id,class:S(["filter-tab",{active:w.value===o.id}])},a(o.name),11,bt)),64))])]),m(l).loading?(i(),n("div",xt,[...e[9]||(e[9]=[t("div",{class:"spinner"},null,-1),t("p",null,"Loading complaints...",-1)])])):b.value.length===0?(i(),n("div",Lt,[e[10]||(e[10]=t("div",{class:"empty-icon"},[t("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e[11]||(e[11]=t("h4",null,"No complaints found",-1)),e[12]||(e[12]=t("p",null,"Start a new complaint to get help with any issues.",-1)),t("button",{onClick:e[1]||(e[1]=o=>h.value=!0),class:"btn-primary"}," Start New Complaint ")])):(i(),n("div",Vt,[(i(!0),n(k,null,g(b.value,o=>(i(),n("div",{key:o.id,onClick:r=>U(o),class:"complaint-card"},[t("div",Bt,[t("div",St,[t("h4",Ht,a(o.title),1),t("span",Nt,a(q(o.category)),1)]),t("span",{class:S(["status-badge",o.status.toLowerCase().replace(" ","-")])},a(o.status),3)]),t("div",Pt,[t("p",null,a(F(o)),1)]),t("div",$t,[t("div",Dt,[e[13]||(e[13]=t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}),t("polyline",{points:"12,6 12,12 16,14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),B(" "+a(O(o.lastMessageAt)),1)]),e[14]||(e[14]=t("div",{class:"complaint-arrow"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])],8,jt))),128))]))]),h.value?(i(),n("div",{key:0,class:"modal-overlay",onClick:C},[t("div",{class:"modal-content",onClick:e[6]||(e[6]=H(()=>{},["stop"]))},[J(Y,{title:"New Complaint",subtitle:"Tell us what went wrong",onClose:C},{icon:K(()=>[...e[16]||(e[16]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M12 8V13",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})],-1)])]),_:1}),t("form",{onSubmit:H(A,["prevent"]),class:"complaint-form"},[t("div",It,[e[17]||(e[17]=t("label",null,"Title",-1)),f(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.title=o),type:"text",placeholder:"Brief description of the issue",required:""},null,512),[[N,d.value.title]])]),t("div",Ut,[e[19]||(e[19]=t("label",null,"Category",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>d.value.category=o),required:""},[e[18]||(e[18]=t("option",{value:""},"Select a category",-1)),(i(!0),n(k,null,g(m(l).complaintCategories,o=>(i(),n("option",{key:o.id,value:o.id},a(o.name),9,At))),128))],512),[[P,d.value.category]])]),t("div",Ft,[e[20]||(e[20]=t("label",null,"Priority",-1)),f(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>d.value.priority=o)},[(i(!0),n(k,null,g(m(l).priorityLevels,o=>(i(),n("option",{key:o.id,value:o.id},a(o.name),9,qt))),128))],512),[[P,d.value.priority]])]),t("div",Ot,[e[21]||(e[21]=t("label",null,"Description",-1)),f(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=o=>d.value.initialMessage=o),placeholder:"Please describe the issue in detail...",rows:"4",required:""},null,512),[[N,d.value.initialMessage]])]),t("div",Rt,[e[26]||(e[26]=t("label",null,"Attach Image or Video (Optional)",-1)),t("div",Zt,[t("input",{ref_key:"fileInput",ref:y,type:"file",onChange:R,accept:"image/*,video/*",class:"file-input",id:"complaint-file"},null,544),e[25]||(e[25]=Q('<label for="complaint-file" class="file-upload-btn" data-v-df57192c><svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-df57192c><path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-df57192c></path><polyline points="7,10 12,15 17,10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-df57192c></polyline><line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-df57192c></line></svg> Choose File </label>',1)),c.value?(i(),n("div",zt,[t("div",Tt,[t("div",Et,[x.value?(i(),n("svg",Wt,[...e[22]||(e[22]=[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2"},null,-1),t("circle",{cx:"8.5",cy:"8.5",r:"1.5",stroke:"currentColor","stroke-width":"2"},null,-1),t("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor","stroke-width":"2"},null,-1)])])):(i(),n("svg",Gt,[...e[23]||(e[23]=[t("polygon",{points:"23 7 16 12 23 17 23 7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2",stroke:"currentColor","stroke-width":"2"},null,-1)])]))]),t("div",Jt,[t("span",Kt,a(c.value.name),1),t("span",Qt,a(Z(c.value.size)),1)]),t("button",{type:"button",onClick:L,class:"remove-file-btn"},[...e[24]||(e[24]=[t("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])])]),x.value?(i(),n("div",Xt,[t("img",{src:v.value,alt:c.value.name},null,8,Yt)])):u("",!0)])):u("",!0)])]),t("div",te,[t("button",{type:"button",onClick:C,class:"btn-secondary"}," Cancel "),t("button",{type:"submit",disabled:m(l).loading,class:"btn-primary"},a(m(l).loading?"Creating...":"Create Complaint"),9,ee)])],32)])])):u("",!0)]))}}),re=z(oe,[["__scopeId","data-v-df57192c"]]);export{re as default};
