import{aC as dt,aD as ct,u as ut,aY as vt,r as a,c as D,aE as ht,aG as i,aH as l,aS as gt,aN as P,aT as pt,aO as j,aI as t,aJ as r,aQ as L,aK as N,aL as B,aX as A,b0 as mt,aM as Q,aU as wt,aV as yt,o as U,f as k}from"./index-BYuuB5GE.js";import{u as kt}from"./cartStore-Bc-KhW7q.js";const _t={class:"shopping-cart-page"},ft={key:0,class:"empty-cart"},Ct={key:1,class:"cart-content"},bt={class:"cart-items"},xt={class:"cart-items-header"},St={class:"cart-items-list"},Dt={class:"item-main"},Pt={class:"item-image"},jt=["src","alt"],Et={key:1,class:"item-placeholder"},Mt={class:"item-details"},$t={class:"item-name"},Ft={class:"item-meta"},It={class:"item-store"},Lt={class:"item-price"},Nt={class:"item-description"},Bt={class:"item-actions"},Rt={class:"quantity-controls"},Ot=["onClick","disabled"],qt={class:"quantity"},Tt=["onClick"],Vt={class:"item-total"},Gt={class:"total-amount"},Ht=["onClick"],zt={class:"order-summary"},Wt={class:"summary-header"},At={class:"summary-content"},Qt={class:"summary-row"},Ut={class:"summary-row"},Zt={key:0,class:"summary-note"},Jt={class:"summary-row total"},Kt=["disabled"],Xt={key:0,width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Yt={key:1},te={key:2},ee={class:"modal-body"},oe={class:"success-header"},se={class:"order-number"},re={class:"order-summary-card"},ne={class:"summary-header"},ae={class:"order-meta"},ie={class:"order-time"},le={class:"order-items-count"},de={class:"order-items-section"},ce={class:"item-main"},ue={class:"item-details"},ve={class:"item-name"},he={class:"item-store"},ge={class:"item-quantity-badge"},pe={class:"item-price"},me={class:"order-totals-section"},we={class:"total-row"},ye={class:"total-row"},ke={class:"total-row total-amount"},_e={class:"delivery-info-card"},fe={class:"delivery-details"},Ce={class:"delivery-time"},be={class:"delivery-value"},xe={class:"rating-header"},Se={class:"store-info-card"},De={class:"store-details"},Pe={class:"progress-indicator"},je={class:"progress-text"},Ee={class:"progress-bar"},Me={class:"rating-section"},$e={class:"star-rating-container"},Fe={class:"stars-wrapper"},Ie=["onClick"],Le={class:"rating-feedback"},Ne={class:"rating-title"},Be={class:"rating-subtitle"},Re={class:"comment-container"},Oe={class:"character-count"},qe={class:"rating-actions"},Te=["disabled"],Ve=Object.assign({name:"ShoppingCartPage"},{__name:"ShoppingCart",setup(Ge){const C=ct(),h=ut(),m=vt(),n=kt(),_=a(!1),b=a(!1),x=a(!1),S=a(""),E=a(""),R=a(""),O=a([]),q=a(0),T=a(0),V=a(0),G=a(0),v=a([]),g=a(0),c=a(0),Z=a(0),w=a(""),M=D(()=>{try{return n?.subtotal||0}catch(o){return console.error("Error computing subtotal:",o),0}}),$=D(()=>{try{return n?.deliveryFee||0}catch(o){return console.error("Error computing delivery fee:",o),0}}),F=D(()=>{try{return n?.total||0}catch(o){return console.error("Error computing total:",o),0}}),H=D(()=>{try{return n?.itemCount||0}catch(o){return console.error("Error computing total items:",o),0}}),J=o=>{n.updateQuantity(o.id,o.quantity+1)},K=o=>{o.quantity>1&&n.updateQuantity(o.id,o.quantity-1)},X=o=>{n.removeItem(o.id)},Y=async()=>{const o=await U.getCurrentUser();if(!h.selectedProject?.id||!o){console.error("Missing project or user information");return}if(console.log("🔍 Starting order placement process..."),console.log("🔍 User:",o.uid),console.log("🔍 Project:",h.selectedProject.id),console.log("🔍 Cart items:",n.items.length),n.items.length>0){const e=[...new Set(n.items.map(s=>s.storeId))];console.log("🔍 Validating store status for stores:",e);for(const s of e)try{const d=`projects/${h.selectedProject.id}/stores/${s}`,y=await k.getDoc(d);if(y.exists){const p=y.data();if(console.log("🔍 Store status check:",{storeId:s,status:p.status,name:p.name}),p.status&&p.status!=="active"){m.showError(`Cannot place order: ${p.name} is currently inactive and not accepting orders.`);return}}else{console.error("❌ Store not found:",s),m.showError("Store not found. Please try again.");return}}catch(d){console.error("❌ Error checking store status:",d),m.showError("Error validating store status. Please try again.");return}}try{_.value=!0,console.log("🔍 Order validation passed, creating order..."),S.value="ORD-"+Date.now().toString().slice(-6);const e=new Date,s=new Date(e.getTime()+45*6e4);E.value=s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),R.value=e.toLocaleString(),O.value=[...n.items],q.value=M.value,T.value=$.value,V.value=F.value,G.value=H.value;const d={orderNumber:S.value,userId:o.uid,userEmail:o.email,projectId:h.selectedProject.id,items:n.items.map(u=>({productId:u.id,productName:u.name,quantity:u.quantity,price:u.price,storeId:u.storeId,storeName:u.storeName})),subtotal:M.value,deliveryFee:$.value,total:F.value,status:"pending",createdAt:new Date,estimatedDelivery:E.value};console.log("🔍 Order data prepared:",d);const y=`projects/${h.selectedProject.id}/orders`,p=await k.addDoc(y,d);console.log("✅ Order created successfully:",p);const f=[...new Set(n.items.map(u=>({id:u.storeId,name:u.storeName})))];n.clearCart(),v.value=f,b.value=!0,m.showSuccess("Order placed successfully!")}catch(e){console.error("❌ Error placing order:",e),m.showError("Failed to place order. Please try again.")}finally{_.value=!1}},tt=()=>{b.value=!1},et=()=>{b.value=!1,ot()},ot=()=>{console.log("Starting rating process for stores:",v.value),g.value=0,c.value=0,w.value="",v.value.length>0?(console.log("Showing rating modal"),x.value=!0):(console.log("No stores to rate, navigating to stores"),C.push("/stores-shopping"))},st=o=>({0:"Select a rating",1:"Poor",2:"Fair",3:"Good",4:"Very Good",5:"Excellent"})[o]||"Select a rating",rt=o=>({0:"Tap a star to rate your experience",1:"We're sorry to hear that. We'll work to improve!",2:"Thanks for the feedback. We're always improving!",3:"Glad you had a good experience!",4:"Wonderful! We're thrilled you enjoyed it!",5:"Amazing! Thank you for the perfect rating!"})[o]||"Tap a star to rate your experience",nt=async()=>{if(c.value!==0)try{const o=await U.getCurrentUser();if(!o){console.error("User not authenticated");return}const e=v.value[g.value],s={storeId:e.id,storeName:e.name,userId:o.uid,userEmail:o.email,rating:c.value,comment:w.value,orderNumber:S.value,createdAt:new Date},d=`projects/${h.selectedProject.id}/ratings`;await k.addDoc(d,s),await at(e.id),g.value<v.value.length-1?(g.value++,c.value=0,w.value=""):(x.value=!1,C.push("/stores-shopping"))}catch(o){console.error("Error submitting rating:",o),m.showError("Error submitting rating. Please try again.")}},z=()=>{x.value=!1,C.push("/stores-shopping")},at=async o=>{try{const e=`projects/${h.selectedProject.id}/stores/${o}`;if((await k.getDoc(e)).exists){const d=`projects/${h.selectedProject.id}/ratings`,y={filters:[{field:"storeId",operator:"==",value:o}],timeoutMs:6e3},f=(await k.getDocs(d,y)).docs.map(I=>I.data().rating),u=f.reduce((I,W)=>I+W,0)/f.length,lt={rating:parseFloat(u.toFixed(1)),reviewCount:f.length,updatedAt:new Date};await k.updateDoc(e,lt)}}catch(e){console.error("Error updating store rating:",e)}},it=()=>{C.push("/stores-shopping")};return ht(()=>{try{if(console.log("ShoppingCart component mounted"),console.log("Cart store before loading:",n),!n){console.error("Cart store is not initialized!");return}n.loadCart(),console.log("Cart loaded successfully"),console.log("Cart store after loading:",n),console.log("Cart items after loading:",n.items),console.log("Cart itemCount after loading:",n.itemCount)}catch(o){console.error("Error loading cart:",o),n&&(n.items=[])}}),(o,e)=>(l(),i("div",_t,[gt(pt,{title:o.$t("shoppingCart"),subtitle:o.$t("reviewItems")},null,8,["title","subtitle"]),j(n).items.length===0?(l(),i("div",ft,[e[4]||(e[4]=t("div",{class:"empty-cart-icon"},[t("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t("h2",null,r(o.$t("emptyCart")),1),t("p",null,r(o.$t("addProductsMessage")),1),t("button",{class:"browse-stores-btn",onClick:it},[e[3]||(e[3]=t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),L(" "+r(o.$t("browseStores")),1)])])):(l(),i("div",Ct,[t("div",bt,[t("div",xt,[t("h2",null,r(o.$t("cartItems"))+" ("+r(H.value)+")",1)]),t("div",St,[(l(!0),i(N,null,B(j(n).items,s=>(l(),i("div",{key:s.id,class:"cart-item"},[t("div",Dt,[t("div",Pt,[s.image?(l(),i("img",{key:0,src:s.image,alt:s.name},null,8,jt)):(l(),i("div",Et,[...e[5]||(e[5]=[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M20 7L10 17L5 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]))]),t("div",Mt,[t("h3",$t,r(s.name),1),t("div",Ft,[t("span",It,r(s.storeName),1),t("span",Lt,"EGP "+r(s.price),1)]),t("p",Nt,r(s.description),1)])]),t("div",Bt,[t("div",Rt,[t("button",{class:"quantity-btn",onClick:d=>K(s),disabled:s.quantity<=1},[...e[6]||(e[6]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Ot),t("span",qt,r(s.quantity),1),t("button",{class:"quantity-btn",onClick:d=>J(s)},[...e[7]||(e[7]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Tt)]),t("div",Vt,[t("span",Gt,"EGP "+r((s.price*s.quantity).toFixed(2)),1)]),t("button",{class:"remove-btn",onClick:d=>X(s)},[...e[8]||(e[8]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],8,Ht)])]))),128))])]),t("div",zt,[t("div",Wt,[t("h2",null,r(o.$t("orderSummary")),1)]),t("div",At,[t("div",Qt,[t("span",null,r(o.$t("subtotal")),1),t("span",null,"EGP"+r(M.value.toFixed(2)),1)]),t("div",Ut,[t("span",null,r(o.$t("deliveryFee")),1),t("span",null,"EGP"+r($.value.toFixed(2)),1)]),j(n).items.length>0&&j(n).items[0].storeDeliveryFee?(l(),i("div",Zt,[t("small",null,r(o.$t("storeDeliveryFee")),1)])):P("",!0),t("div",Jt,[t("span",null,r(o.$t("total")),1),t("span",null,"EGP"+r(F.value.toFixed(2)),1)])]),t("button",{class:"place-order-btn",onClick:Y,disabled:_.value},[_.value?P("",!0):(l(),i("svg",Xt,[...e[9]||(e[9]=[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),_.value?(l(),i("span",Yt,r(o.$t("placingOrder")),1)):(l(),i("span",te,r(o.$t("placeOrder")),1))],8,Kt)])])),b.value?(l(),i("div",{key:2,class:"modal-overlay",onClick:tt},[t("div",{class:"modal-content",onClick:e[0]||(e[0]=A(()=>{},["stop"]))},[t("div",ee,[t("div",oe,[e[10]||(e[10]=t("div",{class:"success-icon"},[t("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"currentColor","stroke-width":"2"})])],-1)),e[11]||(e[11]=t("h3",null,"Order Confirmed!",-1)),t("p",se,"#"+r(S.value),1),e[12]||(e[12]=t("div",{class:"order-status-badge"},[t("span",{class:"status-dot"}),t("span",null,"Pending")],-1))]),t("div",re,[t("div",ne,[e[13]||(e[13]=t("h4",null,"Order Summary",-1)),t("div",ae,[t("span",ie,r(R.value),1),t("span",le,r(G.value)+" items",1)])]),t("div",de,[(l(!0),i(N,null,B(O.value,s=>(l(),i("div",{key:s.id,class:"order-item-card"},[t("div",ce,[t("div",ue,[t("h5",ve,r(s.name),1),t("p",he,r(s.storeName),1)]),t("div",ge,r(s.quantity),1)]),t("div",pe,"EGP "+r((s.price*s.quantity).toFixed(2)),1)]))),128))]),t("div",me,[t("div",we,[e[14]||(e[14]=t("span",null,"Subtotal",-1)),t("span",null,"EGP"+r(q.value.toFixed(2)),1)]),t("div",ye,[e[15]||(e[15]=t("span",null,"Delivery Fee",-1)),t("span",null,"EGP"+r(T.value.toFixed(2)),1)]),t("div",ke,[e[16]||(e[16]=t("span",null,"Total",-1)),t("span",null,"EGP"+r(V.value.toFixed(2)),1)])])]),t("div",_e,[e[19]||(e[19]=t("div",{class:"delivery-header"},[t("div",{class:"delivery-icon"},[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M16 3h5v5M21 3l-7 7M8 21l-5-5v-5h5l5 5z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])]),t("h4",null,"Delivery Information")],-1)),t("div",fe,[t("div",Ce,[e[17]||(e[17]=t("span",{class:"delivery-label"},"Estimated Delivery",-1)),t("span",be,r(E.value),1)]),e[18]||(e[18]=t("p",{class:"delivery-message"},"We'll notify you when your order is ready for pickup or delivery.",-1))])])]),t("div",{class:"modal-footer"},[t("button",{class:"continue-shopping-btn",onClick:et}," Continue Shopping ")])])])):P("",!0),x.value?(l(),i("div",{key:3,class:"rating-modal-overlay",onClick:z},[t("div",{class:"rating-modal-content",onClick:e[2]||(e[2]=A(()=>{},["stop"]))},[t("div",xe,[t("div",Se,[e[21]||(e[21]=t("div",{class:"store-avatar"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),t("div",De,[t("h3",null,r(v.value[g.value]?.name),1),e[20]||(e[20]=t("p",null,"How was your experience?",-1))])]),t("div",Pe,[t("span",je,r(g.value+1)+" of "+r(v.value.length),1),t("div",Ee,[t("div",{class:"progress-fill",style:mt({width:`${(g.value+1)/v.value.length*100}%`})},null,4)])])]),t("div",Me,[t("div",$e,[t("div",Fe,[(l(),i(N,null,B(5,s=>t("button",{key:s,class:Q(["star-button",{filled:s<=c.value,hover:s<=(Z.value||c.value)}]),onClick:d=>c.value=s},[...e[22]||(e[22]=[t("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})],-1)])],10,Ie)),64))]),t("div",Le,[t("h4",Ne,r(st(c.value)),1),t("p",Be,r(rt(c.value)),1)])]),t("div",Re,[e[23]||(e[23]=t("label",{for:"rating-comment",class:"comment-label"},[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),L(" Share your experience (optional) ")],-1)),wt(t("textarea",{id:"rating-comment","onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),placeholder:"What made your experience great? Any suggestions for improvement?",class:"comment-textarea",rows:"3",maxlength:"200"},null,512),[[yt,w.value]]),t("div",Oe,r(w.value.length)+"/200",1)])]),t("div",qe,[t("button",{class:"skip-button",onClick:z},[...e[24]||(e[24]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M19 14l-7-7m0 0l-7 7m7-7v18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),L(" Skip ",-1)])]),t("button",{class:Q(["submit-button",{disabled:c.value===0}]),onClick:nt,disabled:c.value===0},[t("span",null,r(g.value===v.value.length-1?"Finish Rating":"Rate Next Store"),1),e[25]||(e[25]=t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M5 12h14m-7-7l7 7-7 7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1))],10,Te)])])])):P("",!0)]))}}),We=dt(Ve,[["__scopeId","data-v-604c3f98"]]);export{We as default};
