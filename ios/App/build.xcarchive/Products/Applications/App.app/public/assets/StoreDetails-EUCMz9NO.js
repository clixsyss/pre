import{aC as U,aR as Z,aD as q,u as K,r as d,c as Q,aE as X,aG as a,aH as i,aS as W,aI as e,aN as c,aT as Y,aJ as l,aM as p,aK as S,aL as x,aO as $,aU as B,aV as ee,aZ as te,aX as se,f as j}from"./index-BYuuB5GE.js";import{u as oe}from"./cartStore-Bc-KhW7q.js";const re={class:"store-details-page"},ae={class:"store-info-section"},ie={class:"store-basic-info"},le={class:"store-image"},ne=["src","alt"],ce={key:1,class:"store-placeholder"},de={class:"store-details"},ue={class:"store-name-container"},ve={class:"store-name"},ge={class:"store-meta"},he={class:"location"},pe={class:"delivery"},we={key:0,class:"delivery-fee"},me={key:0,class:"store-rating"},_e={class:"rating-stars"},fe={class:"rating-value"},ke={class:"rating-count"},ye={key:0,class:"cart-count"},Ce={class:"search-section"},Pe={class:"search-container"},Le={class:"products-container"},Se={key:0,class:"loading-state"},xe={key:1,class:"empty-state"},je={key:2,class:"products-grid"},Ie=["data-product-id"],Me={class:"product-image-container"},be={class:"product-image"},De=["src","alt"],Ee={key:0,class:"category-badge"},Fe={class:"product-actions"},$e=["onClick"],Be={class:"product-content"},Te={class:"product-header"},Ve={class:"product-name"},He={key:0,class:"product-rating"},Ne={class:"stars"},Re={class:"rating-text"},ze={key:0,class:"product-description"},Oe={class:"product-footer"},Ge={class:"price-section"},Ae={class:"product-price"},Je={key:0,class:"original-price"},Ue=["onClick","disabled"],Ze={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},qe={key:1,class:"mini-spinner"},Ke={key:0,class:"toast success"},Qe={key:1,class:"toast error"},Xe=Object.assign({name:"StoreDetailsPage"},{__name:"StoreDetails",setup(We){const u=Z(),I=q(),g=K(),f=oe(),r=d(null),h=d([]),k=d(!1),w=d(""),M=d("all"),m=d(null),y=d(!1),C=d(!1),v=d(new Set),b=d({}),D=Q(()=>{let s=h.value;if(w.value){const t=w.value.toLowerCase();s=s.filter(o=>o.name.toLowerCase().includes(t)||o.description&&o.description.toLowerCase().includes(t))}return M.value!=="all"&&(s=s.filter(t=>t.category===M.value)),s}),E=s=>!s.image||b.value[s.id],T=async()=>{if(!(!g.selectedProject?.id||!u.params.storeId))try{k.value=!0,console.log("🔍 Fetching store details for store:",u.params.storeId);const s=`projects/${g.selectedProject.id}/stores/${u.params.storeId}`,t=await j.getDoc(s);if(t.exists){const o=t.data();console.log("✅ Store data found:",o);try{const n=`projects/${g.selectedProject.id}/ratings`,P={filters:[{field:"storeId",operator:"==",value:u.params.storeId}],timeoutMs:6e3},_=(await j.getDocs(n,P)).docs.map(L=>L.data().rating),J=_.length>0?_.reduce((L,F)=>L+F,0)/_.length:0;r.value={id:u.params.storeId,...o,rating:parseFloat(J.toFixed(1)),reviewCount:_.length},console.log("✅ Store with ratings:",r.value)}catch(n){console.error("❌ Error fetching ratings for store:",u.params.storeId,n),r.value={id:u.params.storeId,...o,rating:0,reviewCount:0}}await V(u.params.storeId)}else console.log("❌ Store not found"),I.push("/stores-shopping")}catch(s){console.error("❌ Error fetching store:",s)}finally{k.value=!1}},V=async s=>{if(g.selectedProject?.id)try{console.log("🔍 Fetching store products for store:",s);const t=`projects/${g.selectedProject.id}/stores/${s}/products`;console.log("🔍 Products collection path:",t);const o=await j.getDocs(t,{timeoutMs:6e3});console.log("🔍 Products query result:",o.docs.length,"products found"),h.value=o.docs.map(n=>{const P=n.data();return{id:n.id,...P}}),console.log("✅ Fetched products:",h.value),h.value.forEach(n=>{console.log(`Product: ${n.name}, Image: ${n.image}`)})}catch(t){console.error("❌ Error fetching store products:",t),h.value=[]}},H=async s=>{if(r.value){if(r.value.status&&r.value.status!=="active"){C.value=!0,setTimeout(()=>{C.value=!1},3e3);return}try{m.value=s.id,f.addItem(s,r.value.id,r.value.name,r.value.deliveryFee||0),y.value=!0,setTimeout(()=>{y.value=!1},2e3)}catch(t){console.error("Error adding to cart:",t)}finally{m.value=null}}},N=()=>{I.push("/shopping-cart")},R=s=>{v.value.has(s.id)?v.value.delete(s.id):v.value.add(s.id),localStorage.setItem("favoriteProducts",JSON.stringify(Array.from(v.value)))},z=s=>v.value.has(s),O=()=>{const s=localStorage.getItem("favoriteProducts");if(s)try{v.value=new Set(JSON.parse(s))}catch(t){console.error("Error loading product favorites:",t)}},G=s=>{console.log("Image loaded successfully:",s.target.src),s.target.style.display="block"},A=s=>{console.error("Image failed to load:",s.target.src);const t=s.target.closest(".product-card")?.getAttribute("data-product-id")||s.target.alt||"unknown";b.value[t]=!0,s.target.style.display="none"};return X(()=>{O(),T()}),(s,t)=>(i(),a("div",re,[W(Y,{title:s.$t("storeDetails"),subtitle:s.$t("discoverProducts")},null,8,["title","subtitle"]),e("div",ae,[e("div",ie,[e("div",le,[r.value?.image?(i(),a("img",{key:0,src:r.value.image,alt:r.value?.name},null,8,ne)):(i(),a("div",ce,[...t[1]||(t[1]=[e("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])]))]),e("div",de,[e("div",ue,[e("h2",ve,l(r.value?.name),1),r.value?.status&&r.value.status!=="active"?(i(),a("div",{key:0,class:p(["store-status-badge",r.value.status])},l(r.value.status==="inactive"?s.$t("closed"):s.$t("maintenance")),3)):c("",!0)]),e("div",ge,[e("span",he,l(r.value?.location),1),e("span",pe,l(r.value?.averageDeliveryTime)+" "+l(s.$t("delivery").toLowerCase()),1),r.value?.deliveryFee?(i(),a("span",we,"EGP"+l(r.value.deliveryFee)+" "+l(s.$t("deliveryFeeLabel")),1)):c("",!0)]),r.value?.rating?(i(),a("div",me,[e("div",_e,[(i(),a(S,null,x(5,o=>e("svg",{key:o,class:p(["star",{filled:o<=(r.value.rating||0)}]),width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[...t[2]||(t[2]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2)),64))]),e("span",fe,l((r.value.rating||0).toFixed(1)),1),e("span",ke,l((r.value.reviewCount||0)===0?"No reviews yet":`(${r.value.reviewCount} reviews)`),1)])):c("",!0)]),e("button",{class:"cart-button",onClick:N},[t[3]||(t[3]=e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M6 2L3 6V20C3 20.5304 3.21071 21.0391 3.58579 21.4142C3.96086 21.7893 4.46957 22 5 22H19C19.5304 22 20.0391 21.7893 20.4142 21.4142C20.7893 21.0391 21 20.5304 21 20V6L18 2H6Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),$(f).itemCount>0?(i(),a("span",ye,l($(f).itemCount),1)):c("",!0)])])]),e("div",Ce,[e("div",Pe,[t[4]||(t[4]=e("svg",{class:"search-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),e("path",{d:"M21 21L16.65 16.65",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),B(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>w.value=o),type:"text",placeholder:"Search products...",class:"search-input"},null,512),[[ee,w.value]])])]),e("div",Le,[k.value?(i(),a("div",Se,[...t[5]||(t[5]=[e("div",{class:"loading-spinner"},null,-1)])])):D.value.length===0?(i(),a("div",xe,[...t[6]||(t[6]=[e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 7L10 17L5 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("p",null,"No products found",-1)])])):(i(),a("div",je,[(i(!0),a(S,null,x(D.value,o=>(i(),a("div",{key:o.id,"data-product-id":o.id,class:"product-card"},[e("div",Me,[e("div",be,[o.image?(i(),a("img",{key:0,src:o.image,alt:o.name,onLoad:G,onError:A,class:"product-img"},null,40,De)):c("",!0),B(e("div",{class:p(["product-placeholder",{show:E(o)}])},[...t[7]||(t[7]=[e("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 7L10 17L5 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2),[[te,E(o)]])]),o.category?(i(),a("div",Ee,[e("span",null,l(o.category.toUpperCase()),1)])):c("",!0),e("div",Fe,[e("button",{class:p(["action-btn",{active:z(o.id)}]),onClick:se(n=>R(o),["stop"])},[...t[8]||(t[8]=[e("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})],-1)])],10,$e)])]),e("div",Be,[e("div",Te,[e("h3",Ve,l(o.name),1),o.rating?(i(),a("div",He,[e("div",Ne,[(i(),a(S,null,x(5,n=>e("svg",{key:n,class:p(["star",{filled:n<=(o.rating||0)}]),width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[...t[9]||(t[9]=[e("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2)),64))]),e("span",Re,l((o.rating||0).toFixed(1)),1)])):c("",!0)]),o.description?(i(),a("p",ze,l(o.description),1)):c("",!0),e("div",Oe,[e("div",Ge,[e("span",Ae,"EGP "+l(o.price),1),o.originalPrice&&o.originalPrice>o.price?(i(),a("span",Je,"EGP "+l(o.originalPrice),1)):c("",!0)]),e("button",{class:"add-btn",onClick:n=>H(o),disabled:m.value===o.id},[m.value!==o.id?(i(),a("svg",Ze,[...t[10]||(t[10]=[e("path",{d:"M12 5V19M5 12H19",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])):(i(),a("div",qe))],8,Ue)])])],8,Ie))),128))]))]),y.value?(i(),a("div",Ke,[...t[11]||(t[11]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M9 12L11 14L15 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"Added to cart",-1)])])):c("",!0),C.value?(i(),a("div",Qe,[...t[12]||(t[12]=[e("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),e("span",null,"This store is currently inactive and not accepting orders",-1)])])):c("",!0)]))}}),st=U(Xe,[["__scopeId","data-v-8d31c54a"]]);export{st as default};
