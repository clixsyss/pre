import{aC as U,aD as C,aR as j,u as I,c as u,r as c,aE as P,bd as M,o as n,be as g,bf as k,b4 as x,ba as S,aH as E,bg as T,bh as B,bi as v}from"./index-BYuuB5GE.js";const F={__name:"ViolationChat",setup(R){const m=C(),h=j(),s=I(),o=u(()=>h.params.id),r=c(!1),t=c(null),l=c(null),p=u(()=>t.value?.messages||[]);P(async()=>{try{r.value=!0;const a=await M(s.selectedProject.id,o.value);t.value=a;const e=await n.getCurrentUser();e&&await g(s.selectedProject.id,o.value,e.uid),l.value=k(s.selectedProject.id,o.value,async i=>{if(i){t.value=i;const d=await n.getCurrentUser();d&&g(s.selectedProject.id,o.value,d.uid)}})}catch(a){console.error("Error loading violation:",a)}finally{r.value=!1}}),x(()=>{l.value&&l.value()});const f=async a=>{if(t.value)try{const e=await n.getCurrentUser();if(!e)throw new Error("You must be logged in to send messages.");await v(s.selectedProject.id,o.value,{senderType:"user",senderId:e.uid,text:a})}catch(e){throw console.error("Error sending message:",e),e}},b=async a=>{try{const e=await B(s.selectedProject.id,o.value,a);await v(s.selectedProject.id,o.value,{senderType:"user",senderId:(await n.getCurrentUser()).uid,text:"",imageUrl:e})}catch(e){throw console.error("Error uploading image:",e),e}},w=()=>{m.go(-1)},y=()=>{console.log("Message sent successfully")},_=()=>{console.log("Image uploaded successfully")};return(a,e)=>(E(),S(T,{"chat-data":t.value,messages:p.value,loading:r.value,"chat-type":"violation","default-title":"Violation Chat","error-title":"Violation Not Found","error-message":"The violation you're looking for doesn't exist or has been deleted.","closed-message":"This violation has been closed. You can view the conversation but cannot send new messages.","closed-placeholder":"This violation is closed","on-send-message":f,"on-image-upload":b,onBack:w,onMessageSent:y,onImageUploaded:_},null,8,["chat-data","messages","loading"]))}},A=U(F,[["__scopeId","data-v-b06f65c5"]]);export{A as default};
