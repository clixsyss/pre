import{j as w,f as a,k as f}from"./index-BYuuB5GE.js";class m{async fetchNews(r,e={}){console.log("🔍 NewsService.fetchNews called with:",{projectId:r,options:e});const{publishedOnly:o=!0,category:t=null,limit:c=null,prioritizeFeatured:i=!1,forceRefresh:d=!1}=e;try{console.log("🚀 NewsService: Getting news from fast collection service...");let s=await w.getNews(r,e,!d);return o&&(s=s.filter(n=>n.isPublished)),t&&(s=s.filter(n=>n.category===t)),i?s.sort((n,l)=>{if(n.featured&&!l.featured)return-1;if(!n.featured&&l.featured)return 1;const h=n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt);return(l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt))-h}):s.sort((n,l)=>{const h=n.createdAt?.toDate?n.createdAt.toDate():new Date(n.createdAt);return(l.createdAt?.toDate?l.createdAt.toDate():new Date(l.createdAt))-h}),c&&s.length>c&&(s=s.slice(0,c)),console.log("🚀 NewsService: Retrieved news items:",s.length),console.log("🚀 NewsService: Filtered news items:",s.length),s.length===0&&!d&&console.warn("🚀 NewsService: No news items found. Consider checking Firebase database or using forceRefresh option."),s}catch(u){throw console.error("❌ Error fetching news:",u),new Error("Failed to fetch news items")}}async createNews(r,e){try{const o={title:e.title,content:e.content,excerpt:e.excerpt||e.content.substring(0,150)+"...",category:e.category||"general",featured:e.featured||!1,isPublished:e.isPublished||!1,interactionsEnabled:e.interactionsEnabled!==!1,mediaUrl:e.mediaUrl||null,mediaType:e.mediaType||"image",mediaFileName:e.mediaFileName||null,authorId:e.authorId,authorName:e.authorName,createdAt:a.serverTimestamp(),updatedAt:a.serverTimestamp(),publishedAt:e.isPublished?a.serverTimestamp():null},t=await a.addDoc(`projects/${r}/news`,o);return console.log("✅ News item created with ID:",t.id),t.id}catch(o){throw console.error("❌ Error creating news item:",o),new Error("Failed to create news item")}}async updateNews(r,e,o){try{const t={...o,updatedAt:a.serverTimestamp()};o.isPublished&&!o.publishedAt&&(t.publishedAt=a.serverTimestamp()),await a.updateDoc(`projects/${r}/news/${e}`,t),console.log("✅ News item updated:",e)}catch(t){throw console.error("❌ Error updating news item:",t),new Error("Failed to update news item")}}async deleteNews(r,e){try{await a.deleteDoc(`projects/${r}/news/${e}`),console.log("✅ News item deleted:",e)}catch(o){throw console.error("❌ Error deleting news item:",o),new Error("Failed to delete news item")}}async getNewsItem(r,e){try{const o=await a.getDoc(`projects/${r}/news/${e}`);if(o.exists()){const t=o.data();return{id:o.id,...t,createdAt:t.createdAt,updatedAt:t.updatedAt,publishedAt:t.publishedAt}}else throw new Error("News item not found")}catch(o){throw console.error("Error getting news item:",o),new Error("Failed to get news item")}}async toggleVisibility(r,e,o){try{const t={isPublished:o,updatedAt:a.serverTimestamp()};o&&(t.publishedAt=a.serverTimestamp()),await a.updateDoc(`projects/${r}/news/${e}`,t),console.log("✅ News visibility toggled:",e,o)}catch(t){throw console.error("❌ Error toggling news visibility:",t),new Error("Failed to toggle news visibility")}}async getNewsStats(r){try{const e=await this.fetchNews(r,{publishedOnly:!1});return{total:e.length,published:e.filter(t=>t.isPublished).length,draft:e.filter(t=>!t.isPublished).length,featured:e.filter(t=>t.featured&&t.isPublished).length,byCategory:{general:e.filter(t=>t.category==="general"&&t.isPublished).length,announcement:e.filter(t=>t.category==="announcement"&&t.isPublished).length,event:e.filter(t=>t.category==="event"&&t.isPublished).length,update:e.filter(t=>t.category==="update"&&t.isPublished).length}}}catch(e){throw console.error("Error getting news stats:",e),new Error("Failed to get news statistics")}}formatNewsDate(r){if(!r)return"Unknown date";try{const e=r.toDate?r.toDate():new Date(r),t=(new Date-e)/(1e3*60*60);if(t<1)return"Just now";if(t<24){const c=Math.floor(t);return`${c} hour${c>1?"s":""} ago`}else return t<48?"Yesterday":e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}}getCategoryLabel(r){return{general:"General",announcement:"Announcement",event:"Event",update:"Update"}[r]||r}truncateContent(r,e=150){return r?r.length>e?r.substring(0,e)+"...":r:""}async getNewsWithReactionCounts(r,e){try{return await Promise.all(e.map(async t=>{try{const c={docs:[]},i={likeCount:0,loveCount:0,laughCount:0,wowCount:0,sadCount:0,angryCount:0,commentCount:0};c.docs.forEach(d=>{switch(d.data().emoji){case"like":case"👍":i.likeCount++;break;case"love":case"❤️":i.loveCount++;break;case"laugh":case"😂":i.laughCount++;break;case"wow":case"😮":i.wowCount++;break;case"sad":case"😢":i.sadCount++;break;case"angry":case"😡":i.angryCount++;break}});try{const d={docs:[]};i.commentCount=d.docs.length}catch(d){console.log("Error fetching comment count:",d)}return{...t,...i}}catch(c){return console.log(`Error fetching reactions for news ${t.id}:`,c),t}}))}catch(o){return console.error("Error getting news with reaction counts:",o),e}}clearNewsCache(r){console.log(`🗑️ NewsService: Clearing news cache for project ${r}`),w.clearProjectCache(r),f.invalidatePattern(`projects/${r}/news`)}async forceRefreshNews(r,e={}){return console.log(`🔄 NewsService: Force refreshing news for project ${r}`),this.fetchNews(r,{...e,forceRefresh:!0})}}const b=new m;export{b as default};
